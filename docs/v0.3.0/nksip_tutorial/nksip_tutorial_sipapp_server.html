<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Module nksip_tutorial_sipapp_server</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module nksip_tutorial_sipapp_server</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>SipApp Tutorial server callback module implementation.

<p><b>Behaviours:</b> <a href="nksip_sipapp.html"><tt>nksip_sipapp</tt></a>.</p>

<h2><a name="description">Description</a></h2><p>SipApp Tutorial server callback module implementation.</p>
 
  This modules implements a proxy server callback module for NkSIP Tutorial.
  It allows any request from any user in domain "nksip", having password "1234".
  Requests without user and domain "nksip" are processed internally (i.e. "sip:nksip").
  Request with user and domain "nksip" are found (as a registrar) and proxied.
  Other requests are proxied to the same origin Request-URI
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#authorize-4">authorize/4</a></td><td>Called to check if a request should be authorized.</td></tr>
<tr><td valign="top"><a href="#get_user_pass-3">get_user_pass/3</a></td><td>Called to check user's password.</td></tr>
<tr><td valign="top"><a href="#handle_call-3">handle_call/3</a></td><td>Synchronous user call.</td></tr>
<tr><td valign="top"><a href="#init-1">init/1</a></td><td>SipApp intialization.</td></tr>
<tr><td valign="top"><a href="#route-6">route/6</a></td><td>Called to decide how to route every new request.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="authorize-4">authorize/4</a></h3>
<div class="spec">
<p><tt>authorize(Auth, ReqId, From, State) -&gt; any()</tt></p>
</div><p><p>Called to check if a request should be authorized.</p>
 
  <p>1) We first check to see if the request is an in-dialog request, coming from     
the same ip and port of a previously authorized request.</p>
 
  <p>2) If not, we check if we have a previous authorized REGISTER request from     
the same ip and port.</p>
 
  <p>3) Next, we check if the request has a valid authentication header with realm
     "nksip". If <code>{{digest, &lt;&lt;"nksip"&gt;&gt;}, true}</code> is present, the user has
     provided a valid password and it is authorized.
     If <code>{{digest, &lt;&lt;"nksip"&gt;&gt;}, false}</code> is present, we have presented     
a challenge, but the user has failed it. We send 403.</p>
 
  4) If no digest header is present, reply with a 407 response sending
     a challenge to the user.
 </p>

<h3 class="function"><a name="get_user_pass-3">get_user_pass/3</a></h3>
<div class="spec">
<p><tt>get_user_pass(User, Realm, State) -&gt; any()</tt></p>
</div><p><p>Called to check user's password.</p>
 
  If the incoming user's realm is "nksip", the password for any user is "1234".
  For other realms, no password is valid.
 </p>

<h3 class="function"><a name="handle_call-3">handle_call/3</a></h3>
<div class="spec">
<p><tt>handle_call(X1, From, State) -&gt; any()</tt></p>
</div><p>Synchronous user call.</p>

<h3 class="function"><a name="init-1">init/1</a></h3>
<div class="spec">
<p><tt>init(X1) -&gt; any()</tt></p>
</div><p>SipApp intialization.</p>

<h3 class="function"><a name="route-6">route/6</a></h3>
<div class="spec">
<p><tt>route(Scheme, User, Domain, ReqId, From, State) -&gt; any()</tt></p>
</div><p><p>Called to decide how to route every new request.</p>
 
  <p>- If the Request-Uri has no user part, and domain is "nksip", process the request    
internally. If domain is not "nksip", and the destination is    
not local (for example because of a Route header), proxy the request.</p>
 
  - If it has user part, and domain is "nksip", find if it is registered and proxy.
    For other domain, proxy the request.
 </p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Nov 15 2013, 19:25:56.</i></p>
</body>
</html>
